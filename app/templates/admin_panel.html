<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Eindr - Multi-Language Label Admin Panel</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        font-weight: 300;
      }

      .header p {
        font-size: 1.1em;
        opacity: 0.9;
      }

      .content {
        padding: 40px;
      }

      .form-section {
        background: #f8f9fa;
        padding: 30px;
        border-radius: 15px;
        margin-bottom: 30px;
        border-left: 5px solid #4facfe;
      }

      .form-title {
        font-size: 1.5em;
        color: #333;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
      }

      .form-title::before {
        content: "üìù";
        margin-right: 10px;
        font-size: 1.2em;
      }

      .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
      }

      label {
        font-weight: 600;
        color: #555;
        margin-bottom: 8px;
        font-size: 0.9em;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      select,
      input,
      textarea {
        padding: 12px 15px;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        font-size: 1em;
        transition: all 0.3s ease;
        background: white;
      }

      select:focus,
      input:focus,
      textarea:focus {
        outline: none;
        border-color: #4facfe;
        box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
      }

      textarea {
        resize: vertical;
        min-height: 100px;
      }

      .btn {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        padding: 15px 30px;
        border: none;
        border-radius: 10px;
        font-size: 1.1em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn-secondary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .alert {
        padding: 15px 20px;
        border-radius: 10px;
        margin: 20px 0;
        font-weight: 500;
      }

      .alert-success {
        background: #d4edda;
        color: #155724;
        border-left: 5px solid #28a745;
      }

      .alert-error {
        background: #f8d7da;
        color: #721c24;
        border-left: 5px solid #dc3545;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        border-top: 5px solid #4facfe;
      }

      .stat-number {
        font-size: 2.5em;
        font-weight: bold;
        color: #4facfe;
        margin-bottom: 5px;
      }

      .stat-label {
        color: #666;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 0.9em;
      }

      .loading {
        opacity: 0.6;
        pointer-events: none;
      }

      @media (max-width: 768px) {
        .form-row {
          grid-template-columns: 1fr;
        }

        .header h1 {
          font-size: 2em;
        }

        .content {
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üåç Multi-Language Label Manager</h1>
        <p>Add and manage translations for your application labels</p>
      </div>

      <div class="content">
        <!-- Statistics -->
        <div class="stats">
          <div class="stat-card">
            <div class="stat-number" id="languageCount">-</div>
            <div class="stat-label">Languages</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="groupCount">-</div>
            <div class="stat-label">Label Groups</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="codeCount">-</div>
            <div class="stat-label">Selected Group Codes</div>
          </div>
        </div>

        <!-- Form Section -->
        <div class="form-section">
          <h2 class="form-title">Add New Label Translation</h2>

          <form id="labelForm">
            <div class="form-row">
              <div class="form-group">
                <label for="language">Language</label>
                <select id="language" name="language" required>
                  <option value="">Select Language...</option>
                </select>
              </div>

              <div class="form-group">
                <label for="labelGroup">Label Group</label>
                <select id="labelGroup" name="labelGroup" required>
                  <option value="">Select Group...</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="labelCode">Label Code</label>
                <select id="labelCode" name="labelCode" required>
                  <option value="">Select Group First...</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="labelText">Translation Text</label>
                <textarea
                  id="labelText"
                  name="labelText"
                  required
                  placeholder="Enter the translated text for this label..."
                ></textarea>
              </div>
            </div>

            <div class="form-row">
              <button type="button" class="btn" onclick="validateLabel()">
                üîç Validate & Preview
              </button>
              <button type="submit" class="btn btn-secondary">
                üíæ Save Translation
              </button>
            </div>
          </form>

          <div id="alertContainer"></div>
        </div>

        <!-- Bulk Add Section -->
        <div class="form-section">
            <h2 class="form-title">Bulk Add Labels</h2>
            <p style="margin-bottom: 20px; color: #666; font-size: 0.9em;">
                Add multiple label translations at once. Select a language and group, then fill in translations for each label code.
            </p>
            
            <form id="bulkForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="bulkLanguage">Language</label>
                        <select id="bulkLanguage" name="bulkLanguage" required>
                            <option value="">Select Language...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="bulkLabelGroup">Label Group</label>
                        <select id="bulkLabelGroup" name="bulkLabelGroup" required>
                            <option value="">Select Group...</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="allowUpdates" name="allowUpdates" style="width: auto; margin: 0;">
                            <span>Allow updates to existing translations</span>
                        </label>
                        <small style="color: #666; display: block; margin-top: 5px;">
                            When checked, existing translations will be updated with new text. When unchecked, existing translations will be skipped.
                        </small>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Translations</label>
                        <div id="bulkTableContainer">
                            <div style="color: #888; font-size: 0.95em;">Select language and group to load label codes...</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <button type="submit" class="btn btn-secondary">
                        üöÄ Bulk Insert Labels
                    </button>
                </div>
            </form>
            
            <div id="bulkAlertContainer"></div>
            <!-- Bulk Results Display -->
            <div id="bulkResults" style="display: none; margin-top: 20px;">
                <h3 style="color: #333; margin-bottom: 15px;">üìä Bulk Insertion Results</h3>
                <div id="bulkResultsContent"></div>
            </div>
        </div>
    </div>

    <script>
      const API_BASE = window.location.origin.includes('localhost') ? 'http://localhost:8000' : window.location.origin;
      // If you still need the deployed backend, adjust here:
      // const API_BASE = 'https://eindr-lp-backend-production.up.railway.app';

      // Authentication header
      const AUTH_HEADER = "Basic " + btoa("admin@karsaaz.com:Admin123");

      // Load initial data
      async function loadData() {
        try {
          await Promise.all([loadLanguages(), loadLabelGroups(), loadStats()]);
        } catch (error) {
          showAlert("Failed to load initial data: " + error.message, "error");
        }
      }

      async function loadLanguages() {
        const response = await fetch(`${API_BASE}/api/languages`);
        const languages = await response.json();

        const select = document.getElementById("language");
        const bulkSelect = document.getElementById("bulkLanguage");

        const options = '<option value="">Select Language...</option>';
        select.innerHTML = options;
        bulkSelect.innerHTML = options;

        // Sort languages by ID
        const sortedLanguages = languages
          .filter((lang) => lang.active)
          .sort((a, b) => a.id - b.id);

        sortedLanguages.forEach((lang) => {
          const option = document.createElement("option");
          option.value = lang.id;
          option.textContent = `${lang.name} (${lang.lang_code})`;
          select.appendChild(option);

          const bulkOption = document.createElement("option");
          bulkOption.value = lang.id;
          bulkOption.textContent = `${lang.name} (${lang.lang_code})`;
          bulkSelect.appendChild(bulkOption);
        });

        document.getElementById("languageCount").textContent = languages.length;
      }

      async function loadLabelGroups() {
        const response = await fetch(`${API_BASE}/api/label-groups`);
        const groups = await response.json();

        const select = document.getElementById("labelGroup");
        const bulkSelect = document.getElementById("bulkLabelGroup");

        const options = '<option value="">Select Group...</option>';
        select.innerHTML = options;
        bulkSelect.innerHTML = options;

        // Sort groups by ID
        const sortedGroups = groups.sort((a, b) => a.id - b.id);

        sortedGroups.forEach((group) => {
          const option = document.createElement("option");
          option.value = group.id;
          option.textContent = group.group_name;
          select.appendChild(option);

          const bulkOption = document.createElement("option");
          bulkOption.value = group.id;
          bulkOption.textContent = group.group_name;
          bulkSelect.appendChild(bulkOption);
        });

        document.getElementById("groupCount").textContent = groups.length;
      }

      async function loadLabelCodes(groupId) {
        if (!groupId) {
          const select = document.getElementById("labelCode");
          select.innerHTML = '<option value="">Select Group First...</option>';
          document.getElementById("codeCount").textContent = "-";
          return;
        }

        try {
          const response = await fetch(
            `${API_BASE}/api/label-groups/${groupId}/codes`
          );
          const codes = await response.json();

          const select = document.getElementById("labelCode");
          select.innerHTML = '<option value="">Select Code...</option>';

          // Sort codes by ID
          const sortedCodes = codes.sort((a, b) => a.id - b.id);

          sortedCodes.forEach((code) => {
            const option = document.createElement("option");
            option.value = code.id;
            option.textContent = code.name;
            select.appendChild(option);
          });

          document.getElementById("codeCount").textContent = codes.length;
        } catch (error) {
          showAlert("Failed to load label codes: " + error.message, "error");
        }
      }

      async function loadStats() {
        try {
          const [langResponse, groupResponse] = await Promise.all([
            fetch(`${API_BASE}/api/languages`),
            fetch(`${API_BASE}/api/label-groups`),
          ]);

          const languages = await langResponse.json();
          const groups = await groupResponse.json();

          document.getElementById("languageCount").textContent =
            languages.length;
          document.getElementById("groupCount").textContent = groups.length;
        } catch (error) {
          console.error("Failed to load stats:", error);
        }
      }

      async function validateLabel() {
        const form = document.getElementById("labelForm");
        const formData = new FormData(form);

        const languageId = formData.get("language");
        const groupId = formData.get("labelGroup");
        const codeId = formData.get("labelCode");
        const labelText = formData.get("labelText");

        if (!languageId || !groupId || !codeId || !labelText) {
          showAlert("Please fill in all fields before validating", "error");
          return;
        }

        try {
          const response = await fetch(`${API_BASE}/api/labels/validate`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: AUTH_HEADER,
            },
            body: JSON.stringify({
              language_id: parseInt(languageId),
              label_group_id: parseInt(groupId),
              label_code_id: parseInt(codeId),
              label_text: labelText,
            }),
          });

          const result = await response.json();

          if (result.valid) {
            showAlert(`‚úÖ Validation successful! ${result.message}`, "success");
          } else {
            showAlert(`‚ùå Validation failed: ${result.message}`, "error");
          }
        } catch (error) {
          showAlert("Validation failed: " + error.message, "error");
        }
      }

      function showAlert(message, type) {
        const container = document.getElementById("alertContainer");
        const alert = document.createElement("div");
        alert.className = `alert alert-${type}`;
        alert.textContent = message;

        container.innerHTML = "";
        container.appendChild(alert);

        setTimeout(() => {
          alert.remove();
        }, 5000);
      }

      // Event listeners
      document.getElementById("labelGroup").addEventListener("change", (e) => {
        loadLabelCodes(e.target.value);
      });

      document
        .getElementById("labelForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const formData = new FormData(e.target);
          const data = {
            language_id: parseInt(formData.get("language")),
            label_id: parseInt(formData.get("labelCode")),
            label_text: formData.get("labelText"),
          };

          try {
            const response = await fetch(`${API_BASE}/api/language-labels`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: AUTH_HEADER,
              },
              body: JSON.stringify(data),
            });

            if (response.ok) {
              showAlert("‚úÖ Translation saved successfully!", "success");
              e.target.reset();
              document.getElementById("labelCode").innerHTML =
                '<option value="">Select Group First...</option>';
              document.getElementById("codeCount").textContent = "-";
            } else {
              const error = await response.json();
              showAlert("‚ùå Failed to save: " + error.detail, "error");
            }
          } catch (error) {
            showAlert("‚ùå Network error: " + error.message, "error");
          }
        });

      // Bulk operations functions
      async function validateBulkLabels() {
        const labelsText = document.getElementById("bulkLabels").value.trim();

        if (!labelsText) {
          showBulkAlert("Please enter labels in JSON format", "error");
          return;
        }

        try {
          const labels = JSON.parse(labelsText);

          if (!Array.isArray(labels)) {
            showBulkAlert("Labels must be an array", "error");
            return;
          }

          if (labels.length === 0) {
            showBulkAlert("Labels array cannot be empty", "error");
            return;
          }

          if (labels.length > 100) {
            showBulkAlert(
              "Maximum 100 labels allowed per bulk operation",
              "error"
            );
            return;
          }

          // Validate each label
          for (let i = 0; i < labels.length; i++) {
            const label = labels[i];
            if (!label.label_code_name || !label.label_text) {
              showBulkAlert(
                `Label at index ${i} is missing required fields (label_code_name or label_text)`,
                "error"
              );
              return;
            }
          }

          showBulkAlert(
            `‚úÖ JSON validation successful! Found ${labels.length} valid labels`,
            "success"
          );
        } catch (error) {
          showBulkAlert("‚ùå Invalid JSON format: " + error.message, "error");
        }
      }

      async function submitBulkLabels() {
        const form = document.getElementById("bulkForm");
        const formData = new FormData(form);

        const languageId = formData.get("bulkLanguage");
        const groupId = formData.get("bulkLabelGroup");
        const labelsText = formData.get("bulkLabels");

        if (!languageId || !groupId || !labelsText) {
          showBulkAlert("Please fill in all fields", "error");
          return;
        }

        try {
          const labels = JSON.parse(labelsText);

          const requestData = {
            language_id: parseInt(languageId),
            label_group_id: parseInt(groupId),
            labels: labels,
          };

          showBulkAlert("üöÄ Processing bulk insertion...", "success");

          const response = await fetch(`${API_BASE}/api/labels/bulk-insert`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: AUTH_HEADER,
            },
            body: JSON.stringify(requestData),
          });

          const result = await response.json();

          if (response.ok) {
            showBulkResults(result);
            showBulkAlert(result.message, result.success ? "success" : "error");

            if (result.success) {
              // Clear form on success
              form.reset();
              document.getElementById("bulkResults").style.display = "none";
            }
          } else {
            showBulkAlert(
              "‚ùå Bulk insertion failed: " + result.detail,
              "error"
            );
          }
        } catch (error) {
          showBulkAlert("‚ùå Network error: " + error.message, "error");
        }
      }

      function showBulkResults(result) {
        const resultsDiv = document.getElementById("bulkResults");
        const contentDiv = document.getElementById("bulkResultsContent");

        let html = `
              <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin-bottom: 20px;">
                      <div style="text-align: center;">
                          <div style="font-size: 2em; font-weight: bold; color: #333;">${result.total_labels}</div>
                          <div style="color: #666; font-size: 0.9em;">Total Labels</div>
                      </div>
                      <div style="text-align: center;">
                          <div style="font-size: 2em; font-weight: bold; color: #28a745;">${result.successful_insertions}</div>
                          <div style="color: #666; font-size: 0.9em;">Inserted</div>
                      </div>
                      <div style="text-align: center;">
                          <div style="font-size: 2em; font-weight: bold; color: #007bff;">${result.successful_updates || 0}</div>
                          <div style="color: #666; font-size: 0.9em;">Updated</div>
                      </div>
                      <div style="text-align: center;">
                          <div style="font-size: 2em; font-weight: bold; color: #ffc107;">${result.skipped_labels || 0}</div>
                          <div style="color: #666; font-size: 0.9em;">Skipped</div>
                      </div>
                      <div style="text-align: center;">
                          <div style="font-size: 2em; font-weight: bold; color: #dc3545;">${result.failed_insertions}</div>
                          <div style="color: #666; font-size: 0.9em;">Failed</div>
                      </div>
                  </div>
              </div>
          `;

        if (result.results && result.results.length > 0) {
          html += '<div style="max-height: 300px; overflow-y: auto;">';
          html +=
            '<table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">';
          html += '<thead><tr style="background: #f8f9fa;">';
          html +=
            '<th style="padding: 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Label Code</th>';
          html +=
            '<th style="padding: 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Translation</th>';
          html +=
            '<th style="padding: 10px; text-align: center; border-bottom: 2px solid #dee2e6;">Action</th>';
          html +=
            '<th style="padding: 10px; text-align: center; border-bottom: 2px solid #dee2e6;">Status</th>';
          html +=
            '<th style="padding: 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Message</th>';
          html += "</tr></thead><tbody>";

          result.results.forEach((item) => {
            const statusColor = item.success ? "#28a745" : "#dc3545";
            const statusIcon = item.success ? "‚úÖ" : "‚ùå";
            const action = item.action || 'unknown';
            const actionColor = action === 'inserted' ? '#28a745' : 
                               action === 'updated' ? '#007bff' : 
                               action === 'skipped' ? '#ffc107' : '#6c757d';

            html += '<tr style="border-bottom: 1px solid #dee2e6;">';
            html += `<td style="padding: 10px; font-family: monospace;">${item.label_code_name}</td>`;
            html += `<td style="padding: 10px;">${item.label_text}</td>`;
            html += `<td style="padding: 10px; text-align: center; color: ${actionColor}; font-weight: bold; text-transform: capitalize;">${action}</td>`;
            html += `<td style="padding: 10px; text-align: center; color: ${statusColor};">${statusIcon}</td>`;
            html += `<td style="padding: 10px; font-size: 0.85em;">${item.message}</td>`;
            html += "</tr>";
          });

          html += "</tbody></table>";
          html += "</div>";
        }

        contentDiv.innerHTML = html;
        resultsDiv.style.display = "block";
      }

      function showBulkAlert(message, type) {
        const container = document.getElementById("bulkAlertContainer");
        const alert = document.createElement("div");
        alert.className = `alert alert-${type}`;
        alert.textContent = message;

        container.innerHTML = "";
        container.appendChild(alert);

        setTimeout(() => {
          alert.remove();
        }, 5000);
      }

      // Bulk table logic
      let bulkCodes = [];
      let bulkTranslations = {};

      async function loadBulkTable() {
          const langId = document.getElementById('bulkLanguage').value;
          const groupId = document.getElementById('bulkLabelGroup').value;
          const container = document.getElementById('bulkTableContainer');
          container.innerHTML = '<div style="color: #888;">Loading label codes...</div>';
          if (!langId || !groupId) {
              container.innerHTML = '<div style="color: #888;">Select language and group to load label codes...</div>';
              return;
          }
          try {
              // Fetch label codes for group
              const codesResp = await fetch(`${API_BASE}/api/label-groups/${groupId}/codes`);
              const codes = await codesResp.json();
              bulkCodes = codes;
              // Fetch existing translations for this language/group
              const labelsResp = await fetch(`${API_BASE}/api/languages/${langId}/labels`);
              const labelsData = await labelsResp.json();
              // Flatten translations into a code->text map
              const transMap = {};
              if (labelsData.labels) {
                  Object.values(labelsData.labels).forEach(groupObj => {
                      Object.entries(groupObj).forEach(([codeName, text]) => {
                          transMap[codeName] = text;
                      });
                  });
              }
              // Render table
              let html = '<table style="width:100%; border-collapse:collapse;">';
              html += '<thead><tr><th style="text-align:left; padding:8px; border-bottom:1px solid #eee;">Label Code</th><th style="text-align:left; padding:8px; border-bottom:1px solid #eee;">Translation</th></tr></thead><tbody>';
              codes.forEach(code => {
                  const val = (transMap[code.name]) || '';
                  html += `<tr><td style="padding:8px; font-family:monospace;">${code.name}</td><td style="padding:8px;"><input type="text" name="bulk_translation_${code.name}" value="${val ? val.replace(/"/g, '&quot;') : ''}" style="width:100%; padding:8px; border-radius:6px; border:1px solid #ccc;" /></td></tr>`;
              });
              html += '</tbody></table>';
              container.innerHTML = html;
          } catch (err) {
              container.innerHTML = '<div style="color:#c00;">Failed to load label codes or translations.</div>';
          }
      }
      document.getElementById('bulkLanguage').addEventListener('change', loadBulkTable);
      document.getElementById('bulkLabelGroup').addEventListener('change', loadBulkTable);

      document.getElementById('bulkForm').addEventListener('submit', async (e) => {
          e.preventDefault();
          const langId = document.getElementById('bulkLanguage').value;
          const groupId = document.getElementById('bulkLabelGroup').value;
          if (!langId || !groupId) {
              showBulkAlert('Please select both language and group.', 'error');
              return;
          }
          // Gather translations
          const labels = [];
          bulkCodes.forEach(code => {
              const val = document.querySelector(`[name=bulk_translation_${code.name}]`).value.trim();
              if (val) {
                  labels.push({ label_code_name: code.name, label_text: val });
              }
          });
          if (labels.length === 0) {
              showBulkAlert('Please enter at least one translation.', 'error');
              return;
          }
          // Prepare request
          const allowUpdates = document.getElementById('allowUpdates').checked;
          const requestData = {
              language_id: parseInt(langId),
              label_group_id: parseInt(groupId),
              allow_updates: allowUpdates,
              labels: labels
          };
          showBulkAlert('üöÄ Processing bulk insertion...', 'success');
          try {
              const response = await fetch(`${API_BASE}/api/labels/bulk-insert`, {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json',
                      'Authorization': AUTH_HEADER
                  },
                  body: JSON.stringify(requestData)
              });
              const result = await response.json();
              if (response.ok) {
                  showBulkResults(result);
                  showBulkAlert(result.message, result.success ? 'success' : 'error');
                  if (result.success) {
                      document.getElementById('bulkForm').reset();
                      document.getElementById('bulkResults').style.display = 'none';
                      document.getElementById('bulkTableContainer').innerHTML = '<div style="color: #888;">Select language and group to load label codes...</div>';
                  }
              } else {
                  showBulkAlert('‚ùå Bulk insertion failed: ' + result.detail, 'error');
              }
          } catch (error) {
              showBulkAlert('‚ùå Network error: ' + error.message, 'error');
          }
      });

      // Load data when page loads
      document.addEventListener("DOMContentLoaded", loadData);
    </script>
  </body>
</html>
